<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Solicitação de Materiais</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    label { font-weight: bold; margin-top: 10px; display: block; }
    select, input[type="text"], input[type="number"] {
      width: 300px; padding: 8px; margin-top: 5px;
    }
    .material-group { display: flex; gap: 10px; margin-top: 10px; }
    button {
      margin-top: 20px; padding: 10px 20px;
      background: #1976d2; color: #fff; border: none; cursor: pointer;
    }
    button:hover { background: #125ca1; }
  </style>
</head>
<body>
  <h2>Formulário de Solicitação CME HGWA</h2>
  <form id="formSolicitacao">
    <label>Solicitante:</label>
    <input type="text" id="solicitante" required>

    <label>Setor:</label>
    <select id="setor" required>
      <option value="" disabled selected>Selecione o setor</option>
      <option value="TI">TI</option>
      <option value="Compras">Compras</option>
      <option value="Almoxarifado">Almoxarifado</option>
      <option value="RH">RH</option>
    </select>

    <div id="materiaisContainer"></div>

    <button type="submit">Finalizar</button>
  </form>

  <script>
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbzVPzVM2LqbgTDitCDCXzl39OkVhaB-OmxbTJbxsAv0t-tPi6EJU6ExHbe_40Sf-IVr0w/exec";

    const container = document.getElementById('materiaisContainer');
    const form = document.getElementById('formSolicitacao');

    function criarLinhaMaterial() {
      const row = document.createElement('div');
      row.className = 'material-group';

      const select = document.createElement('select');
      select.innerHTML = `
        <option value="" selected>Material</option>
        <option value="Caneta">Caneta</option>
        <option value="Papel A4">Papel A4</option>
        <option value="Clips">Clips</option>
        <option value="Mouse">Mouse</option>
      `;

      const inputQtd = document.createElement('input');
      inputQtd.type = 'number';
      inputQtd.min = 1;
      inputQtd.placeholder = 'Qtd.';

      row.appendChild(select);
      row.appendChild(inputQtd);
      container.appendChild(row);

      select.addEventListener('change', () => {
        const ultimos = container.querySelectorAll('select');
        if (select === ultimos[ultimos.length - 1]) {
          criarLinhaMaterial();
        }
      });
    }

    criarLinhaMaterial();

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const materiais = [];
      const grupos = container.querySelectorAll('.material-group');
      grupos.forEach(grupo => {
        const material = grupo.querySelector('select').value;
        const qtd = grupo.querySelector('input').value;
        if (material && qtd) {
          materiais.push({ material, quantidade: qtd });
        }
      });

      if (materiais.length === 0) {
        alert("Adicione ao menos um material.");
        return;
      }

      const payload = {
        solicitante: document.getElementById('solicitante').value,
        setor: document.getElementById('setor').value,
        materiais
      };

       fetch(URL_SCRIPT, {
        method: 'POST',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
      .then(response => response.text())
       .then(msg => {
        alert("Servidor respondeu: " + msg);
       form.reset();
        container.innerHTML = '';
         criarLinhaMaterial();
      })
      .catch(err => {
        console.error(err);
        alert("Erro ao enviar solicitação.");
      });
    });
  </script>
</body>
</html>
